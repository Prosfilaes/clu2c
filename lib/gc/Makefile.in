dnl $Id: Makefile.in,v 2.0 1996/06/10 08:58:33 ushijima Exp $
include(mk.m4)
MK_REQUIRE(`archive')
MK_REQUIRE(`csrc')
MK_CURRENT_DIRECTORY(`lib', `gc')
MK_ARCHIVE_NAME(`../libclu2c.a')
MK_DEFINE_VARIABLE(`DEFAULT_CFLAGS', `-I$(topdir) -DALL_INTERIOR_POINTERS -DNO_SIGNALS -DSILENT')
MK_C_SOURCES(`allchblk.c alloc.c blacklst.c checksums.c dbg_mlc.c dyn_load.c')
MK_C_SOURCES(`finalize.c headers.c mach_dep.c malloc.c mark.c mark_rts.c')
MK_C_SOURCES(`misc.c new_hblk.c obj_map.c os_dep.c ptr_chck.c reclaim.c')
MK_C_SOURCES(`sol_threads.c stubborn.c typd_mlc.c')
MK_MISC_SOURCES(`BCC_MAKEFILE EMX_MAKEFILE MacOS.c MacProjects.sit.hqx Makefile.gc NT_MAKEFILE OS2_MAKEFILE PCR-Makefile README.Mac README.OS2 README.QUICK README.amiga README.debugging README.gc README.win32 SCoptions.amiga SMakefile.amiga add_gc_prefix.c alpha_mach_dep.s barrett_diagram callprocs gc.h gc.man gc_conf.h gc_cpp.cc gc_cpp.h gc_hdrs.h gc_mark.h gc_priv.h gc_private.h gc_typed.h gcc_support.c if_mach.c if_not_there.c makefile.depend mips_mach_dep.s pc_excludes pcr_interface.c real_malloc.c rs6000_mach_dep.s setjmp_t.c sparc_mach_dep.s test.c test_cpp.cc weakpointer.h')
MK_MOSTLYCLEAN_FILES(
`ifelse(OSTYPE, `dos',
	`gctest gctest.exe setjmp_t setjmp_t.exe test.o',
	OSTYPE, `x68',
	`gctest.x setjmp_t.x test.o',
	`gctest if_mach if_not_there setjmp_test test.o')')
MK_APPEND_PREREQ(`check',
	`ifelse(OSTYPE, `dos', `setjmp_t.exe gctest.exe',
		OSTYPE, `x68', `setjmp_t.x gctest.x',
		`setjmp_test gctest')')
MK_APPEND_ACTION(`check',
	`ifelse(OSTYPE, `dos', `setjmp_t',
		OSTYPE, `x68', `setjmp_t',
		`./setjmp_test')')
MK_APPEND_ACTION(`check',
	`ifelse(OSTYPE, `dos', `gctest',
		OSTYPE, `x68', `gctest',
		`./gctest')')
ifelse(OSTYPE, `unix',
`MK_DEFINE_RULE(`mach_dep_o', `mach_dep.o',
	`$(srcdir)/mach_dep.c $(srcdir)/mips_mach_dep.s $(srcdir)/rs6000_mach_dep.s $(srcdir)/alpha_mach_dep.s $(srcdir)/sparc_mach_dep.s if_mach if_not_there',
	`rm -f mach_dep.o
	./if_mach MIPS "" $(AS) -o mach_dep.o $(srcdir)/mips_mach_dep.s
	./if_mach RS6000 "" $(AS) -o mach_dep.o $(srcdir)/rs6000_mach_dep.s
	./if_mach ALPHA "" $(AS) -o mach_dep.o $(srcdir)/alpha_mach_dep.s
	./if_mach SPARC SUNOS5 $(AS) -o mach_dep.o $(srcdir)/sparc_mach_dep.s
	./if_not_there mach_dep.o $(CC) $(DEFAULT_CFLAGS) -c $(SPECIALCFLAGS) $(srcdir)/mach_dep.c')
MK_DEFINE_RULE(`mark_rts_o', `mark_rts.o',
	`$(srcdir)/mark_rts.c if_mach if_not_there',
	`rm -f mark_rts.o
	-./if_mach ALPHA "" $(CC) -c $(ALL_CFLAGS) -Wo`,'-notail $(srcdir)/mark_rts.c
	./if_not_there mark_rts.o $(CC) -c $(ALL_CFLAGS) $(srcdir)/mark_rts.c')
MK_DEFINE_RULE(`if_mach', `if_mach',
	`$(srcdir)/if_mach.c $(srcdir)/gc_conf.h'
	`$(CC) $(ALL_CFLAGS) -o if_mach $(srcdir)/if_mach.c')
MK_DEFINE_RULE(`if_not_there', `if_not_there',
	`$(srcdir)/if_not_there.c',
	`$(CC) $(ALL_CFLAGS) -o if_not_there $(srcdir)/if_not_there.c')')
MK_DEFINE_RULE(`test', `test', `check')
MK_DEFINE_RULE(`gctest',
	`ifelse(OSTYPE, `dos', `gctest.exe', OSTYPE, `x68', `gctest.x', `gctest')',
	`ifelse(OSTYPE, `unix', `archive test.o if_mach if_not_there', `archive test.o')',
`ifelse(OSTYPE, `dos',
	`$(CC) $(ALL_CFLAGS) -o gctest test.o $(ARCHIVE)`'ifelse(DJGPP, 1, `
	$(COFF2EXE) gctest')',
	OSTYPE, `x68',
	`$(CC) $(ALL_CFLAGS) -o gctest.x test.o $(ARCHIVE)',
	`rm -f gctest
	./if_mach ALPHA "" $(CC) $(ALL_CFLAGS) -o gctest $(ALPHACFLAGS) test.o $(ARCHIVE)
	./if_mach SPARC SUNOS5 $(CC) $(ALL_CFLAGS) -o gctest  test.o $(ARCHIVE) -lthread -ldl
	./if_mach SPARC DRSNX $(CC) $(ALL_CFLAGS) -o gctest  test.o $(ARCHIVE) -lucb
	./if_not_there gctest $(CC) $(ALL_CFLAGS) -o gctest test.o $(ARCHIVE)')')
MK_DEFINE_RULE(`setjmp_test',
	`ifelse(OSTYPE, `dos', `setjmp_t.exe', OSTYPE, `x68', `setjmp_t.x', `setjmp_test')',
	`ifelse(OSTYPE, `unix', `$(srcdir)/setjmp_t.c $(srcdir)/gc.h if_mach if_not_there')',
`ifelse(OSTYPE, `dos',
	`$(CC) $(ALL_CFLAGS) -o setjmp_t $(srcdir)/setjmp_t.c`'ifelse(DJGPP, 1, `
	$(COFF2EXE) setjmp_t')',
	OSTYPE, `x68',
	`$(CC) $(ALL_CFLAGS) -o setjmp_t.x $(srcdir)/setjmp_t.c',
	`$(CC) $(ALL_CFLAGS) -o setjmp_test $(srcdir)/setjmp_t.c')')
MK_SPECIFIC_RULES
ifelse(OSTYPE, `unix',
`MK_RULE_DEFINITION(`mach_dep_o', `Creates mach_dep.o')
MK_RULE_DEFINITION(`mark_rts_o', `Creates mark_rts.o')
MK_RULE_DEFINITION(`if_mach', `Creates if_mach')
MK_RULE_DEFINITION(`if_not_there', `Creates if_not_there')',
`dnl')
MK_RULE_DEFINITION(`test', `Executes test program')
MK_RULE_DEFINITION(`gctest', `Creates gctest')
MK_RULE_DEFINITION(`setjmp_test', `Creates setjmp_test')
MK_END
