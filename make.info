Clu2c の make 機能について
==========================


(1) 概要

clu2c には make コマンドが実現されています。make というコマンド名は 
UNIX の make(1) を連想して命名されました。このコマンドは最新でない C 
ファイルを見つけ出し、対応する CLU のファイルをコンパイル（つまり、C 
のファイルに変換）します。

また、一度 make を行なうと、モジュールのインタフェース情報やモジュール
間の依存関係をファイルに保存します。その結果として、プログラム全体とし
ての型の一貫性を保証することができます。


(2) 使い方

コマンドラインで次のように実行します。

% clu2c [ other clu2c commands ... ] #make

clu2c の引数として `#make' を与えると、 clu2c はカレントディレクトリに
CLU プログラムのソースファイルがあるとみなして必要なファイルをコンパイ
ルします。


(3) 大まかな処理の流れ

まず、equ というサフィックスのついたファイルを読み込みます。このファイ
ルには equate のみが書かれていなければなりません。デフォルトでは、カレ
ントディレクトリにある、equ というサフィックスのついたファイルをすべて
読み込みます。また、カレントディレクトリに EQU.xload というファイルが
ある場合には、このファイルに記述されているファイル（１行に１つずつ）の
みが読み込まれます。

次に、各ファイルからモジュールのインタフェース情報を取り出します。デフォ
ルトでは、カレントディレクトリにある、spc または clu というサフィック
スのついたファイルをすべて読みます。また、カレントディレクトリに 
SPC.xload というファイルがある場合には、このファイルに記述されているファ
イル（１行に１つずつ）も合わせて処理されます。ただし、２回目以降では一
番最初に SPC.lib という、インタフェース情報を一か所にまとめたファイル
を読み込みますので、このステップは必要なファイルのみに限定されます。

次に、コンパイルする必要のある CLU ファイルをコンパイルします。さらに、
インタフェースが変化したモジュールについては、そのモジュールを参照して
いるモジュールを含むファイルの型検査を行ないます。

最後に ``All .c files are up to date.'' と表示されれば、make は成功し
たことになります。


(4) make コマンドが管理するファイル

make コマンドは以下のファイルを自動的に作成・管理します。

SPC.lib		モジュールのインタフェース情報を一か所にまとめたもの。

Dependency	モジュールの依存関係の記録。

Location	モジュールのありか（どのファイルにどのモジュールがある
		か）の記録。

SPC.lib はバイナリファイルですが、Dependendcy と Location はテキストファ
イルです。


(5) 最後に

この make コマンドは暫定版です。何かおかしなことが起こったら、「make 
コマンドが管理するファイル」で述べられている３つのファイルを消してから、
再度試してみてください。
